(()=>{"use strict";function e(e){e.addEventListener("mouseover",(t=>{t.preventDefault(),e.childNodes.length>1&&e.children[1].children[1].classList.remove("hidden")}))}function t(e){e.addEventListener("mouseout",(t=>{if(t.preventDefault(),e.childNodes.length>1){const t=e.children[1].children[1];t.classList.contains("hidden")||t.classList.add("hidden")}}))}function s(e){const t=e.getBoundingClientRect();return{x:t.left+t.width/2,y:t.top+t.height/2}}function n(e){let t=e.getBoundingClientRect();return{top:t.top-14,left:t.left-14}}class o{constructor(){o.calculateIds(),this.cards=Array.from(document.getElementsByClassName("card")),this.setDragToAllCards(),this.mouseOverAllCards(),this.mouseOutAllCards(),this.setDeleteButtons()}static setDragAndDropToCard(s){o.dragCard(s),t(s),e(s)}static calculateIds(){const e=Array.from(document.getElementsByClassName("column"));for(let t=0;t<e.length;t++){const s=e[t].getElementsByClassName("card");for(let e=0;e<s.length;e++)s[e].id=t+"-"+e}}static dragCard(e){const t=e.getElementsByClassName("card-title")[0];t.onmousedown=function(s){let r=s.pageX-n(e).left,a=s.pageY-n(e).top;function l(t){e.style.left=t.pageX-r+"px",e.style.top=t.pageY-a+"px"}e.style.position="absolute",l(s),e.style.zIndex="1_000",document.onmousemove=async function(t){l(t),await o.cleanUp(),await o.findClosest(e)},t.onmouseup=async function(){document.onmousemove=null,t.onmouseup=null;let s=Array.from(document.getElementsByClassName("card"));s.forEach((e=>{o.offBorders(e)}));const n=document.getElementsByClassName("insert-inside")[0];null!=n?(n.getElementsByClassName("title")[0].after(e),e.style.position="",n.classList.remove("insert-inside")):s.forEach((t=>{t.classList.contains("insert-before")?t.before(e):t.classList.contains("insert-after")&&t.after(e),t.style.position=""})),await o.calculateIds()},e.ondragstart=function(){return!1}}}static async findClosest(e){const t=s(e),n=Array.from(document.getElementsByClassName("card")),r=Array.from(document.getElementsByClassName("column")).filter((e=>2===e.children.length));await o.cleanUp();let a=!1;for(let e=0;e<r.length;e++){const s=r[e].getBoundingClientRect();document.getElementById("empty-col").textContent=JSON.stringify(s),t.x>=s.left&&t.x<=s.right&&t.y<=s.bottom&&t.y>=s.top&&(r[e].classList.add("insert-inside"),a=!0)}if(!a){const r=document.getElementById("curcoords"),a=document.getElementById("closest-card-number"),l=document.getElementById("closest-card-coords");let d,c=99999;for(let o=0;o<n.length;o++)if(n[o].id!==e.id){n[o].getBoundingClientRect();const e=s(n[o]);Math.abs(Math.abs(t.x-e.x)-Math.abs(t.y-e.y))<=c&&(c=Math.abs(Math.abs(t.x-e.x)-Math.abs(t.y-e.y)),d=o)}r.textContent=JSON.stringify(t),a.textContent=d,l.textContent=JSON.stringify(n[d].getBoundingClientRect());const i=s(n[d]);t.y<=i.y&&t.y<=i.y?(n[d].classList.add("insert-before"),o.onBorders(n[d],e.getBoundingClientRect().height,"top")):t.y>=i.y&&t.y>=i.y&&(n[d].classList.add("insert-after"),o.onBorders(n[d],e.getBoundingClientRect().height,"bot"))}}static offBorders(e){e.style.borderTopWidth="",e.style.borderTopStyle="",e.style.borderTopColor="",e.style.borderBottomWidth="",e.style.borderBottomStyle="",e.style.borderBottomColor=""}static onBorders(e,t,s){if("top"===s)e.style.borderTopWidth=t+"px",e.style.borderTopStyle="solid",e.style.borderTopColor="grey";else{if("bot"!==s)throw new Error("idn what to do!");e.style.borderBottomWidth=t+"px",e.style.borderBottomStyle="solid",e.style.borderBottomColor="grey"}}static cleanUp(){Array.from(document.getElementsByClassName("card")).forEach((e=>{e.classList.remove("insert-after"),e.classList.remove("insert-before"),e.style.zIndex="",o.offBorders(e)}));Array.from(document.getElementsByClassName("column")).forEach((e=>{e.classList.remove("insert-inside")}))}static setDelete(e){e.addEventListener("click",(t=>{t.preventDefault(),e.parentElement.parentElement.remove()}))}setDragToAllCards(){this.cards.forEach((e=>{o.dragCard(e)}))}mouseOverAllCards(){this.cards.forEach((t=>{e(t)}))}mouseOutAllCards(){this.cards.forEach((e=>{t(e)}))}setDeleteButtons(){Array.from(document.getElementsByClassName("delete")).forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),e.parentElement.parentElement.remove()}))}))}}new o,new class{constructor(){this.showWindow(),this.add()}showWindow(){let e=document.getElementById("card-addition");Array.from(document.getElementsByClassName("add")).forEach((t=>{t.addEventListener("click",(s=>{s.preventDefault(),t.id="new-card-insert-here",e.show()}))})),document.getElementById("exit").onclick=function(){e.close()}}add(){document.getElementById("confirm-add-new-card").addEventListener("click",(e=>{e.preventDefault();const t=document.getElementsByClassName("new-card-content")[0],s=document.createElement("div");s.className="card";const n=document.createElement("div");n.className="card-title",n.textContent=t.value,s.append(n);const r=document.createElement("div");r.className="like";const a=document.createElement("div");a.classList.add("delete"),a.classList.add("hidden"),o.setDelete(a);const l=document.createElement("div");l.className="comment";const d=document.createElement("div");d.className="buttons",d.append(r),d.append(a),d.append(l),s.append(d);const c=document.getElementById("new-card-insert-here");c.before(s),c.id="",o.setDragAndDropToCard(s),t.value="",document.getElementById("card-addition").close(),o.calculateIds()}))}}})();